{% extends 'extends/base.html' %}
{% load static %}
{% block custom_stylesheet %}
<link rel="stylesheet" type="text/css" href="{% static 'plugins/DataTables/datatables.min.css' %}" /> 
{% endblock custom_stylesheet %}

{% block tab_title %} VSF - Events {% endblock tab_title %}
{% block title %} Events {% endblock title %}
{% block sub_title %} List and filter all the currently available events {% endblock sub_title %}

{% block route %}

<li class="breadcrumb-item">
  <a href="{% url home %}"><i class="feather icon-home"></i></a>
</li>
<li class="breadcrumb-item">
  <a href="{% url 'dashboard:events:all' %}">Events List</a>
</li>

{% endblock route %}

{% block content %}



  <form id="urlForm">
    <nav class="navbar navbar-light bg-light mb-5">
      <div class="container-fluid">
        <div class="row">

          <div class="col-4">
            <input
            id="identification"
            class="form-control mr-2 additional-filter border-top-0 border-left-0 border-right-0 bg-transparent"
            type="search"
            placeholder="Identification"
            aria-label="Search identification"
            value="{{ prefill.identification }}"
            name="identification"
            />
          </div>
          <div class="col-4">
            <div class="row align-items-center rounded p-2 bg-dark ml-1">
              <div class="col-5 mx-auto">
                <label class='font-weight-bold text-white' for="confirmed">
                  Confirmed
                </label>
              </div>
              <div class="col-7 mx-auto">
                <select id="confirmed" class="custom-select additional-filter" name="confirmed">
                  <option value="">Any Confirmation</option>
                  
                  <option {% if prefill.confirmed == "true" %} selected {% endif %} value="true">True</option>
                  <option {% if prefill.confirmed == "false" %} selected {% endif %} value="false">False</option>
                  
                </select>
              </div>
            </div> 
          </div>

          <div class="col-4">
            <div class="row align-items-center rounded p-2 bg-dark ml-1">
              <div class="col-5 mx-auto">
                <label class='font-weight-bold text-white'>
                  Start Time
                </label>
              </div>
              <div class="col-7 mx-auto">
                <input id="start_time" class="text-white form-control mr-2 additional-filter" type="date" value="{{ prefill.start_time }}" name="start_time"/>
              </div>
            </div> 
          </div>

          <div class="col-4 mt-3">
            <div class="row align-items-center rounded p-2 bg-dark">
              <div class="col-5 mx-auto">
                <label class='font-weight-bold text-white'>
                  End Time
                </label>
              </div>
              <div class="col-7 mx-auto">
                <input id="end_time" class="text-white form-control mr-2 additional-filter" type="date" value="{{ prefill.end_time }}" name="end_time"/>
              </div>
            </div> 
          </div>

          <div class="col-4 mt-3">
            <input
            id="public_evidence"
            class="form-control mr-2 additional-filter border-top-0 border-left-0 border-right-0 bg-transparent"
            type="search"
            placeholder="Public Evidence"
            aria-label="Search public evidence"
            value="{{ prefill.public_evidence }}"
            name="public_evidence"
            />
          </div>

          <div class="col-4 mt-3">
            <input
            id="private_evidence"
            class="form-control mr-2 additional-filter border-top-0 border-left-0 border-right-0 bg-transparent"
            type="search"
            placeholder="Private evidence"
            aria-label="Search private evidence"
            value="{{ prefill.private_evidence }}"
            name="private_evidence"
            />
          </div>
          
          <div class="col-3 mt-3">
            <div class="row align-items-center rounded p-2 bg-dark">
              <div class="col-5 mx-auto">
                <label class="font-weight-bold text-white" for="site">Issue Type</label>
              </div>
              <div class="col-7 mx-auto">
                <select class="custom-select additional-filter" id="issue_type" name="issue_type">
                  <option selected value="">
                    Any Issue
                  </option>
                  {% for issue in issueTypes %}
                    <option 
                    {% if issue.name == prefill.issue_type %} selected {% endif %}
                    value="{{ issue.name }}" 
                    >
                    {{ issue.name }}
                    </option>
                  {% endfor %}
                </select>
              </div>
            </div>   
          </div>

          <div class="col-4 mt-3">
            <input
            id="domain"
            class="form-control mr-2 additional-filter border-top-0 border-left-0 border-right-0 bg-transparent"
            type="search"
            placeholder="Domain"
            aria-label="Search domain"
            value="{{ prefill.domain }}"
            name="domain"
            />
          </div>


          <div class="col-4 mt-3">
            <div class="row align-items-center rounded p-2 bg-dark ml-1">
              <div class="col-3 mx-auto">
                <label class='font-weight-bold text-white' for="asn">
                  ASN
                </label>
              </div>
              <div class="col-9 mx-auto">
                <select id="asn" class="custom-select additional-filter" name="asn">
                  <option value="">Any ASN</option>
                  {% for asn in asns %}
                    <option 
                    {% if asn.asn == prefill.asn %} selected {% endif %}
                    value="{{ asn.asn }}" 
                    >
                    {{ asn.asn }} - {{ asn.name }}
                    </option>
                  {% endfor %}
                </select>
              </div>
            </div> 
          </div>


          <div class="col-1 my-auto">
            <button id="url-form-button" class="btn btn-outline-dark btn-block" type="submit">
              <i class="fa fa-search"></i>
            </button>
          </div>

        </div> 
      </div>   
      {% include "includes/measurements-includes/copy-clipboard-search-url.html" %}
    </nav>

    {% if user.is_analist %}
    <form id="sitesForm">    
      <button type="button" class="btn btn-dark rounded mb-4" id="addToSite" data-toggle="modal" data-target="#submitConfirmationModal">
        <i class="fa fa-folder-plus"></i> Add to Case
      </button>
    </form>
    {% endif %}


    <div class="card rounded p-3 mt-4" style="width: 100%;">
        <table class="table table-striped mt-5 datatable" id="events">
          <thead>
            <tr>
              <th class="text-center" scope="col">Associate</th>
              <th class="text-center" scope="col">Event Type</th>
              <th class="text-center" scope="col">Confirmed</th>
              <th class="text-center" scope="col">Start Date</th>
              <th class="text-center" scope="col">End Date</th>
              <th class="text-center" scope="col">Domain</th>
              <th class="text-center" scope="col">ASN</th>
              <th class="text-center" scope="col">Actions</th>
            </tr>
          </thead>
          <tbody>
            {% for event in object_list %}
            <tr>
              <td>
                  <div class="form-check">
                      <label class="form-check-label">
                          <input name="associated-values" type="checkbox" value="checkedValue"
                              aria-label="Group of associated events" id="{{ event.id }}"
                              class="associate-events" data-vsf-domain="{{ event.identification }}"
                          />
                      </label>
                  </div>
              </td>
              <td>
                  {{ event.issue_type }}
              </td>
              <td>
                  {% if event.confirmed %}
                  <div class="text-success w-100 text-center">
                      <i class="far fa-check-circle text-success" title="Event is Confirmed"></i>
                  </div>
                  {% else %}
                  <div class="text-danger w-100 text-center">
                      <i class="far fa-check-circle text-default" title="Event not Confirmed"></i>
                  </div>
                  {% endif %}
              </td>
              <td>
                  {{ event.start_date }}
              </td>
              <td>
                  {{ event.end_date }}
              </td>
              <td>
                  {{ event.domain }}
              </td>
              <td>
                  {{ event.asn }}
              </td>  
               
              <td>
                  <button type="button" class="bs-modal btn btn-sm btn-dark" 
                  onclick="open_edit_modal('{% url 'dashboard:events:event_edit' event.id %}')">Expand</button>
                  {% if user.is_analist %} 
                    {% if event.confirmed %}
                        <a href="">
                            <button type="button" class="btn btn-sm btn-danger confirm-case">Deny</button>
                        </a>
                    {% else %}
                    <a href="">
                        <button type="button" class="btn btn-sm btn-success confirm-case">Confirm</button>
                    </a>
                    {% endif %}
                  {% endif %}
              </td>
              
            </tr>         
            {% endfor %}
          </tbody>
        </table>
    </div>
  </form>
  
  <div class="modal fade" id='edit_event' role="dialog"></div>





  {% block extrajs %}
    <script type="text/javascript" src="{% static 'plugins/DataTables/datatables.min.js' %}"></script>
    <script type="text/javascript" src="{% static 'js/scripts.js' %}"></script>


    <script type="text/javascript">
        $('#events').DataTable();

        $('measurements').DataTable();

        var $ = jQuery.noConflict()

      function open_edit_modal(url){
        $('#edit_event').load(url, function(){
            $(this).modal('show');

      });}

    </script>

  {% endblock extrajs %}

{% endblock content %}
