<!--
  ========================================
  THIS SCRIPT IS INTENDED TO BE COUPLED WITH THE CREATE-SITES-MODAL.HTML

  INCLUDE THIS HTML IN THE CUSTOM SCRIPT BLOCK IN THE TEMPLATE THAT INCLUDES
  CREATE-SITES-MODAL.HTML
  ========================================
-->

<script>
  /*
  ========================================
  THIS PART IS THE AJAX REQUEST
  ========================================
  */

  $( "#vsf-sites-input, #vsf-description-input" ).on("change paste keyup", function() {

    if ( $("#vsf-sites-input" ).val() === "" || $("#vsf-description-input" ).val() === "" )  {

      $("#create-sites-btn").attr('disabled', true);
    } else {

      $("#create-sites-btn").attr('disabled', false);
    }
  });

  $("#create-sites-btn").click(function ( event ) {

    "use strict";
    event.preventDefault();

    let $form = $("#site-creation-form");
    let data  = $form.serialize();
    let url   = '{% url "sites:create_site" %}';

    $.ajax({
      type   : "POST",
      url    : url,
      data   : data,
      success: function ( data, status ) {

        $("#associateUrl").modal("hide");

        if ( data.error === null ) {

          Swal.fire({
            icon              : "success",
            title             : "The site has been created!",
            confirmButtonColor: "#28a745",
            confirmButtonText : "Continue"
          }).then((result) => {

            if ( result.isConfirmed ) {

              location.reload();
            }
          });
        }
        else {

          Swal.fire({
            icon              : "warning",
            title             : "The name's site is already in use!",
            confirmButtonColor: "#ffc107",
            confirmButtonText : "Continue"
          })
        }
      },
      error: function ( XMLHttpRequest, textStatus, errorThrown ) {

        Swal.fire({
          icon              : "error",
          title             : "There was an error!",
          text              : `${ textStatus }: ${ errorThrown }`,
          confirmButtonColor: "#dc3545",
          confirmButtonText : "Continue"
        });
      }
    });
  });
</script>
