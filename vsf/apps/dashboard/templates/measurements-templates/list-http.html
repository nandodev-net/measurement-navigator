<!--
  ========================================
  MAIN HTTP LISTING
  ========================================
-->

{% extends 'extends/base.html' %}

{% load static %}

{% block custom_stylesheet %}
<link
  rel="stylesheet"
  type="text/css"
  href="{% static 'plugins/DataTables/datatables.min.css' %}"
/>
<link rel=stylesheet
  href="https://cdn.jsdelivr.net/npm/pretty-print-json@0.3/dist/pretty-print-json.css"
/>
{% endblock custom_stylesheet %}

{% block tab_title %} VSF - HTTP {% endblock tab_title %}
{% block title %} HTTP {% endblock title %}

{% block sub_title %} List and filter all the currently available HTTP Sub-measurements {% endblock sub_title %}

{% block route %}
<li class="breadcrumb-item">
  <a href="{% url home %}">Home</a>
</li>
<li class="breadcrumb-item">Measurements</li>
<li class="breadcrumb-item active">
  <a href="{% url 'dashboard:submeasurement:list_http' %}">HTTP List</a>
</li>
{% endblock route %}

{% block content %}
<nav class="navbar navbar-light bg-light mb-5">
  <form id="urlForm">
    <div class="container-fluid">
      <div class="row">
        <div class="col-3">
          <div class="row align-items-center rounded p-2 bg-info">
            <div class="col-3 mx-auto">
              <label class='font-weight-bold text-white'>
                Since
              </label>
            </div>
            <div class="col-9 mx-auto">
              <input id="since" class="form-control mr-2 additional-filter" type="date" value="{{ prefill.since }}" name="since"/>
            </div>
          </div> 
        </div>

        <div class="col-3">
          <div class="row align-items-center rounded p-2 bg-info ml-1">
            <div class="col-3 mx-auto">
              <label class='font-weight-bold text-white'>
                Until
              </label>
            </div>
            <div class="col-9 mx-auto">
              <input id="until" class="form-control mr-2 additional-filter" type="date" value="{{ prefill.until }}" name='until'/>
            </div>
          </div> 
        </div>

        <div class="col-6">
          <div class="row align-items-center rounded p-2 bg-info ml-1 w-100">
            <div class="col-3 mx-auto">
              <label class='font-weight-bold text-white' for="asn">
                ASN
              </label>
            </div>
            <div class="col-9 mx-auto">
              <select id="asn" class="custom-select additional-filter" name="asn">
                <option value="">Any ASN</option>
                {% for asn in asns %}
                  <option 
                  {% if asn.asn == prefill.asn %} selected {% endif %}
                  value="{{ asn.asn }}" 
                  >
                  {{ asn.asn }} - {{ asn.name }}
                  </option>
                {% endfor %}
              </select>
            </div>
          </div> 
        </div>

        <div class="col-3 mt-3">
          <div class="row align-items-center rounded p-2 bg-info">
            <div class="col-3 mx-auto">
              <label class="font-weight-bold text-white" for="anomaly-state">Anomaly</label>
            </div>
            <div class="col-9 mx-auto">
              <select id="anomaly-state" class="custom-select additional-filter" name="anomaly">
                <option selected value="">Any</option>
                <option {% if prefill.anomaly == 'false' %} selected {% endif %}
                value="false">Anomaly False</option>
                <option {% if prefill.anomaly == 'true'  %} selected {% endif %}
                value="true">Anomaly True</option>
              </select>
            </div>
          </div> 
        </div>

        <div class="col-6 mt-3">
          <input
            id="input"
            class="form-control additional-filter border-top-0 border-left-0 border-right-0 bg-transparent"
            type="search"
            placeholder="URL"
            aria-label="Search URL"
            name="input"
            value="{{prefill.input}}"
          />
        </div>

        <div class="col-3 mt-3">
          <div class="row align-items-center rounded p-2 bg-info mr-1">
            <div class="col-4 mx-auto">
              <label class="font-weight-bold text-white" for="site">Site</label>
            </div>
            <div class="col-8 mx-auto">
              <select class="custom-select additional-filter" id="site" name="site">
                <option selected value="">
                  Any Site
                </option>
                {% for site in sites %}
                  <option value="{{ site.id }}" title="{{ site.description }}" {% if prefill.site == site.id|stringformat:"i" %} selected {% endif %}>
                    {{ site.name }}
                  </option>
                {% endfor %}
              </select>
            </div>
          </div>   
        </div>

        <div class="col-3 mt-3">
          <div class="row align-items-center rounded p-2 bg-info">
            <div class="col-4 mx-auto">
              <label class="font-weight-bold text-white" for="test-name">Flag Type</label>
            </div>
            <div class="col-8 mx-auto">
              <select id="flag" class="custom-select additional-filter" name="flag">
                <option selected value="">Any</option>
                {% for flag in flags %}
                <option {% if prefill.flag == flag.value %} selected {% endif %} value="{{ flag.value }}">
                  {{ flag.name }}
                </option>
                {% endfor %}
              </select>
            </div>
          </div>   
        </div>

        <div class="col-4 mt-3">
          <div class="row align-items-center rounded p-2 bg-info ml-1">
            <div class="col-4 mx-auto">
              <label class="font-weight-bold text-white" for="status-code-match">Status Code</label>
            </div>
            <div class="col-8 mx-auto">
              <select id="status-code-match" class="custom-select additional-filter" name="status_code_match">
                <option selected value="">Any</option>
                <option {% if prefill.status_code_match == 'false' %} selected {% endif %}
                value="false">Don't Match</option>
                <option {% if prefill.status_code_match == 'true'  %} selected {% endif %}
                value="true">Match</option>
              </select>
            </div>
          </div>   
        </div>

        <div class="col-5 mt-3">
          <div class="row align-items-center rounded p-2 bg-info ml-1">
            <div class="col-4 mx-auto">
              <label class="font-weight-bold text-white" for="headers-match">Headers</label>
            </div>
            <div class="col-8 mx-auto">
              <select id="headers-match" class="custom-select additional-filter" name="headers_match">
                <option 
                selected value="">Any</option>
                <option {% if prefill.headers_match == 'false' %} selected {% endif %}
                value="false">Don't Match</option>
                <option {% if prefill.headers_match == 'true'  %} selected {% endif %}
                value="true">Match</option>
              </select>
            </div>
          </div>   
        </div>

        <div class="col-4 mt-3">
          <div class="row align-items-center rounded p-2 bg-info">
            <div class="col-4 mx-auto">
              <label class="font-weight-bold text-white" for="body-length-match">Body Length</label>
            </div>
            <div class="col-8 mx-auto">
              <select id="body-length-match" class="custom-select additional-filter" name="body_length_match">
                <option selected value="">Any</option>
                <option {% if prefill.body_length_match == 'false' %} selected {% endif %}
                value="false">Don't Match</option>
                <option {% if prefill.body_length_match == 'true'  %} selected {% endif %}
                value="true">Match</option>
              </select>
            </div>
          </div>   
        </div>

        <div class="col-4 mt-3">
          <div class="row align-items-center rounded p-2 bg-info ml-1">
            <div class="col-6 mx-auto">
              <label class="font-weight-bold text-white" for="body-proportion-min">Min. Body Proportion</label>
            </div>
            <div class="col-6 mx-auto">
              <input
                id="body-proportion-min"
                class="additional-filter"
                type="range"
                min="0"
                max="1"
                step="0.01"
                value="{{prefill.body_proportion_min}}"
                name="body_proportion_min"
              />
            </div>
          </div> 
        </div>

        <div class="col-4 mt-3">
          <div class="row align-items-center rounded p-2 bg-info ml-1">
            <div class="col-6 mx-auto">
              <label class="font-weight-bold text-white" for="body-proportion-max">Max. Body Proportion</label>
            </div>
            <div class="col-6 mx-auto">
              <input
                id="body-proportion-max"
                class="additional-filter"
                type="range"
                min="0"
                max="1"
                step="0.01"
                value="{{prefill.body_proportion_max}}"
                name="body_proportion_max"
              />
            </div>
          </div> 
        </div>

      </div>
    </div>
  </form>
  <!-- copy-to-clipboard component for search fields -->
  {% include "includes/measurements-includes/copy-clipboard-search-url.html" %}
</nav>

  <h4><strong>Last HTTP Measurement from:</strong> {{last_measurement_date}} </h4>
  <div class="w-100 overflow-auto">
    <table class="table table-striped mt-5 datatable" id="my-table">
      <thead>
        <tr>
          <th class="text-center text-capitalize" scope="col">Input</th>
          <th class="text-center text-capitalize" scope="col">Start Time</th>
          <th class="text-center text-capitalize" scope="col">ASN</th>
          <th class="text-center text-capitalize" scope="col">country</th>
          <th class="text-center text-capitalize" scope="col">Site</th>
          <th class="text-center text-capitalize" scope="col">Anomaly</th>
          <th class="text-center text-capitalize" scope="col">Flag</th>
          <th class="text-center text-capitalize" scope="col">
            Status Code Match
          </th>
          <th class="text-center text-capitalize" scope="col">Headers Match</th>
          <th class="text-center text-capitalize" scope="col">
            Body Length Match
          </th>
          <th class="text-center text-capitalize" scope="col">
            Body proportion
          </th>
        </tr>
      </thead>

      <tbody></tbody>

      <tfoot></tfoot>
    </table>
  </div>

{% include "includes/measurements-includes/detailed-info-modal.html" %}
{% endblock content %}

{% block custom_scripts %}
<script
  type="text/javascript"
  src="{% static 'plugins/DataTables/datatables.min.js' %}"
></script>
<script src="https://cdn.jsdelivr.net/npm/pretty-print-json@0.3/dist/pretty-print-json.min.js"></script>
<!-- measurement table js controller -->
{% include "includes/js/measurements-includes-js/list-http-dt-js.html" %}
<!-- Copy to clipboard text area controller -->
{% include "includes/js/measurements-includes-js/copy-clipboard-search-url-js.html" %}

{% endblock custom_scripts %}
