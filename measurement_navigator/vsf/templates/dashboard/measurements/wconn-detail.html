

<div class="card py-0 px-5 mt-5" id="failures-card">
    <a href="#!" class="btn btn-header-link collapsed" data-toggle="collapse" data-target="#failures" aria-expanded="true" aria-controls="failures"> 
        <div class="card-header">
            <h5 class="mb-0">Failures</h5>
        </div>
    </a>

    <div class="collapse" id="failures">
        <div class="card-body">
            <div class="row">
                <div class="col-3">
                    <p class="font-weight-bold">HTTP Experiment</p>
                </div>
                <div class="col-9">
                    <div id="http-experiment">
                        <i class="fas fa-check"></i> null
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-3">
                    <p class="font-weight-bold">DNS Experiment</p>
                </div>
                <div class="col-9">
                    <div id="dns-experiment">
                        <i class="fas fa-check"></i> null
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-3">
                    <p class="font-weight-bold">Control</p>
                </div>
                <div class="col-9">
                    <div id="control-experiment">
                        <i class="fas fa-check"></i> null
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="card py-0 px-5 mt-3" id="dns-card">
    <a href="#!" class="btn btn-header-link collapsed" data-toggle="collapse" data-target="#dns" aria-expanded="true" aria-controls="dns">
        <div class="card-header">
            <h5 class="mb-0">DNS Queries</h5>
        </div>
    </a>

    <div class="collapse" id="dns">
        <div class="card-body">
            <div class="row">
                <div class="col-6">
                    <p class="text-success"><strong>Experiment</strong></p><br>
                    <p><strong>Resolver: </strong> {{rawmeasurement.test_keys.client_resolver}}</p>

                    {% for query in rawmeasurement.test_keys.queries %}
                        <div class="border-bottom border-top py-4">
                            <p><strong>Query: </strong> IN {{query.query_type}} {{query.hostname}}</p>
                            <p><strong>Engine: </strong> {{query.engine}} </p>

                            <div class="row">
                                <div class="col-1"><p><strong>Name</strong></p></div>
                                <div class="col-1"><p><strong>Class</strong></p></div>
                                <div class="col-1"><p><strong>TTL</strong></p></div>
                                <div class="col-1"><p><strong>Type</strong></p></div>
                                <div class="col-2"><p><strong>DATA</strong></p></div>
                                <div class="col-6"></div>
                            </div>

                            {% for item in query.answers %}
                            <div class="row">
                                {% if item.as_org_name == '<unknown>' %}
                                    <div class="col-1"><p>@</p></div>
                                {% else %}
                                    <div class="col-1"><p>@ {{ item.as_org_name }}</p></div>
                                {% endif %}
                                <div class="col-1"><p>IN</p></div>
                                {% if item.ttl %}
                                    <div class="col-1"><p> {{ item.ttl }}</p></div>
                                {% else %}
                                    <div class="col-1"><p></p></div>
                                {% endif %}
                                <div class="col-1"><p> {{ item.answer_type }} </p></div>
                                <div class="col-2"><p>{{ item.ipv4 }}</p></div>
                                <div class="col-6"></div>
                            </div>
                            {% endfor %}
                        </div>
                    {% endfor %}

                </div>
                <div class="col-6">
                    <p class="text-success"><strong>Control</strong></p><br>
                    <div class="row">
                        <div class="col-6">
                            <p><strong>Address:</strong></p>
                            <ul>
                                {% for addr in rawmeasurement.test_keys.control.dns.addrs %}
                                    <li>{{ addr }}</li>
                                {% endfor %}
                            </ul>
                        </div>
                        <div class="col-6">
                            <p><strong>Failure:</strong></p>
                            {% if rawmeasurement.test_keys.control.dns.failure %}
                                <p>
                                    {{ rawmeasurement.test_keys.control.dns.failure }}
                                </p>
                            {% else %}
                                <i class="fas fa-check"></i> null
                            {% endif %}
                        </div>
                    </div>

                    
                </div>
            </div>
            
            
            
        </div>
    </div>
</div>

<div class="card py-0 px-5 mt-3" id="tcp-card">
    <a href="#!" class="btn btn-header-link collapsed" data-toggle="collapse" data-target="#tcp" aria-expanded="true" aria-controls="tcp">
        <div class="card-header">
            <h5 class="mb-0">TCP Connections</h5>
        </div>
    </a>
    <div class="collapse" id="tcp">
        <div class="card-body">
            {% if rawmeasurement.hasTcpConnections %}
                <div class="row">
                    <div class="col-6">
                        <p class="text-success">Experiment</p>
                    </div>
                    <div class="col-6">
                        <p class="text-success">Control</p>
                    </div>
                </div>
                <hr>
                {% for connection in rawmeasurement.tcp_connections %}
                    <div class="row">
                        <div class="col-6">
                            {% if connection.status.success %}
                                <p> Connection to <strong>{{connection.ip}}</strong> succeeded.</p>
                            {% elif connection.status.failure %}
                                <p> Connection to <strong>{{connection.ip}}</strong> failed.</p>
                            {% else %}
                                <p> Connection to <strong>{{connection.ip}}</strong> was blocked.</p>
                            {% endif %}
                        </div>
                        <div class="col-6">
                            <p>Status: {{ connection.control_status }}</p>
                            {% if connection.control_failures %}
                                <p>Failure: {{ connection.control_failures }}</p>
                            {% else %}
                                <p>Failure: <i class="fas fa-check"></i> null</p>
                            {% endif %}
                            
                        </div>
                    </div>
                    <hr>
                    
                {% endfor %}

            {% else %}
                <p>No data</p>
            {% endif %}
        </div>
    </div>
</div>

<div class="card py-0 px-5 mt-3" id="http-card">
    <a href="#!" class="btn btn-header-link collapsed" data-toggle="collapse" data-target="#http" aria-expanded="true" aria-controls="http">
        <div class="card-header">
            <h5 class="mb-0">HTTP Requests</h5>
        </div>
    </a>
    <div class="collapse" id="http">
        <div class="card-body">
            {% if rawmeasurement.hasHttpRequests %}
                
                {% for req in rawmeasurement.test_keys.requests %}
                    <h5 class="font-weight-bold">URL</h5>
                    <div class="shadow-none p-3 mb-5 bg-light rounded">{{req.request.url}}</div>
                    <div class="row">
                        <div class="col-6">
                            <h5 class="font-weight-bold">Response Headers</h5>
                            <div class="shadow-none p-3 mb-5 bg-light rounded">
                                {% for key, value in req.response.headers.items %}
                                    <strong>{{key}}: </strong> {{value}}<br>
                                {% endfor %}
                            </div>
                        </div>
                        <div class="col-6">
                            <h5 class="font-weight-bold">Control Headers</h5>
                            <div class="shadow-none p-3 mb-5 bg-light rounded">
                                {% for key, value in rawmeasurement.test_keys.control.http_request.headers.items %}
                                    <strong>{{key}}: </strong> {{value}}<br>
                                {% endfor %}
                            </div>
                        </div>
                    </div>

                    <h5 class="font-weight-bold">Response Body</h5>
                    <div class="shadow-none p-3 mb-5 bg-light rounded">
                        <!-- Response body api call -->
                        {{ http_body }}
                    </div>
                {% endfor %}
            {% else %}
                <p>No data</p>
            {% endif %}
        </div>
    </div>
</div>

<div class="shadow-none p-3 mb-2 bg-secondary rounded" id="flags">
    <p class="text-white">
        <bold>DNS Flags: </bold>
        {% for dns_flag in flags.dns %}
            {% if dns_flag == 'ok' %}
                <span class="badge badge-pill badge-success">OK</span>
            {% elif dns_flag == 'soft' %}
                <span class="badge badge-pill badge-warning">SOFT</span>
            {% elif dns_flag == 'hard' %}
                <span class="badge badge-pill badge-danger">HARD</span>
            {% elif dns_flag == 'manual' %}
                <span class="badge badge-pill badge-info">MANUAL</span>
            {% elif dns_flag == 'muted' %}
                <span class="badge badge-pill badge-muted">MUTED</span>
            {% endif %}
        {% endfor %}
    </p>
    <p class="text-white">
        <bold>HTTP Flags: </bold>
        {% for http_flags in flags.http %}
            {% if http_flags == 'ok' %}
                <span class="badge badge-pill badge-success">OK</span>
            {% elif http_flags == 'soft' %}
                <span class="badge badge-pill badge-warning">SOFT</span>
            {% elif http_flags == 'hard' %}
                <span class="badge badge-pill badge-danger">HARD</span>
            {% elif http_flags == 'manual' %}
                <span class="badge badge-pill badge-info">MANUAL</span>
            {% elif http_flags == 'muted' %}
                <span class="badge badge-pill badge-muted">MUTED</span>
            {% endif %}
        {% endfor %}
    </p>
    <p class="text-white">
        <bold>TCP Flags: </bold>
        {% for tcp_flag in flags.tcp %}
            {% if tcp_flag == 'ok' %}
                <span class="badge badge-pill badge-success">OK</span>
            {% elif tcp_flag == 'soft' %}
                <span class="badge badge-pill badge-warning">SOFT</span>
            {% elif tcp_flag == 'hard' %}
                <span class="badge badge-pill badge-danger">HARD</span>
            {% elif tcp_flag == 'manual' %}
                <span class="badge badge-pill badge-info">MANUAL</span>
            {% elif tcp_flag == 'muted' %}
                <span class="badge badge-pill badge-muted">MUTED</span>
            {% endif %}
        {% endfor %}
    </p>
</div>

<div class="card py-0 px-5 mt-2" id="events-card">
    <a href="#!" class="btn btn-header-link collapsed" data-toggle="collapse" data-target="#events" aria-expanded="true" aria-controls="events">
        <div class="card-header">
            <h5 class="mb-0">Events</h5>
        </div>
    </a>
    <div class="collapse" id="events">
        <div class="card-body">
            <table class="table table-striped mt-5 datatable" id="events-table">
            <thead>
                <tr>
                <th class="text-center" scope="col">Event Type</th>
                <th class="text-center" scope="col">Confirmed</th>
                <th class="text-center" scope="col">Start Date</th>
                <th class="text-center" scope="col">End Date</th>
                <th class="text-center" scope="col">Domain</th>
                <th class="text-center" scope="col">ASN</th>
                </tr>
            </thead>
            <tbody>
                {% for event in events %}
                    <tr>
                        <td>{{event.issue_type}}</td>
                        <td>
                            {% if event.confirmed %}
                                <div class="text-success w-100 text-center">
                                    <i class="far fa-check-circle text-success" title="Event is Confirmed"></i>
                                </div>
                            {% else %}
                                <div class="text-danger w-100 text-center">
                                    <i class="far fa-check-circle text-default" title="Event not Confirmed"></i>
                                </div>
                            {% endif %}
                        </td>
                        <td>{{event.start_date}}</td>
                        <td>{{event.end_date}}</td>
                        <td>{{event.domain}}</td>
                        <td>{{event.asn}}</td>
                    </tr>
                {% endfor %}
            </tbody>
            </table>
        </div>
    </div>
</div>

